{{> header}}
<style>
    body {
        display: -ms-flexbox;
        display: -webkit-box;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
        padding-top: 40px;
        padding-bottom: 40px;
        background-color: #f5f5f5;
    }

    @media only screen and (min-width: 769px) {
        .container {
            width: auto;
            margin: auto;
        }
    }
</style>
{{> dashboardnav}}

<form id="registerform" class="form-signin text-center" action="/adduser" method="POST"
    onsubmit="return submitvalidate()">
    {{!-- <a class="nav-link" style="color: black" href="/"><h2 style=" font-family: 'Roboto';font-weight: bold;">Bookbrary</h2></a> --}}

    <h1 class="h3 mb-3 font-weight-normal">Crear Usuario</h1>

    <label for="inputName" class="sr-only">Nombre Completo</label>
    <input type="text" autocomplete="off" name="nombre" id="inputName" onkeydown="return alphaOnly(event);"
        class="form-control register" placeholder="Nombre Completo" required="" autofocus="">

    <label for="inputUserame" class="sr-only">Nombre de Usuario</label>
    <input type="text" autocomplete="off" name="username" id="inputUserame" onkeydown="return alphanumericOnly(event);"
        class="form-control register" placeholder="Nombre de Usuario" required="" autofocus="">

    <label for="inputEmail" class="sr-only">Email</label>
    <input type="email" autocomplete="off" name="email" id="inputEmail" class="form-control" placeholder="Email"
        required="" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
    <small class="form-text text-muted text-left register" id="emailver"></small>

    <label class="sr-only" for="role">Rol del Usuario</label>
    <select class="form-control register" id="role" name="role">
        <option selected="true" disabled="disabled"> Seleccione un rol</option>
        <option value="USER_ROLE">Cliente</option>
        <option value="ADMIN_ROLE">Administrador</option>
    </select>




    <label for="inputPassword" class="sr-only">Contrase√±a</label>
    <input type="password" autocomplete="off" name="password" id="inputPassword" class="form-control "
        placeholder="Contrase√±a" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" required="">
    <small class="form-text text-muted text-left register">Debe contener <span id="letter">una min√∫scula</span>, <span
            id="capital">una may√∫scula</span>, <span id="number">un n√∫mero</span> y <span id="lenght">al menos 8
            caracteres.
        </span></small>
    <label for="inputCPassword" class="sr-only">Confirmar Contrase√±a</label>
    <input type="password" autocomplete="off" id="inputCPassword" class="form-control register"
        placeholder="Confirmar Contrase√±a" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" required="">
    <small class="form-text text-muted text-left"><span id="confmsg"></span></small>
    <div class="checkbox mb-3">

    </div>
    <button class="btn btn-lg  btn-success btn-block" type="submit">Crear Cuenta</button>
</form>
</div>
</div>
{{#if message}}
<div class="toast" style="position: absolute;right: 0;top: 0;" data-autohide="false" role="alert" aria-live="assertive"
    aria-atomic="true">
    <div class="toast-header">
        <strong class="mr-auto">üìö Bookbary</strong>
        <small>1 secs ago</small>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="toast-body">
        Usuario creado con √©xito ‚ò∫.
    </div>
</div>
{{/if}}

<script src="/assets/js/signup-helpers.js"></script>
{{> packages}}
<script>
    $('.toast').toast('show')
    function alphaOnly(event) {
        var key = event.keyCode;
        return ((key >= 65 && key <= 90) || key == 8 || key == 9 || key == 32);
    };
    function alphanumericOnly(event) {
        var key = event.keyCode;
        return ((key >= 65 && key <= 90) || key == 8 || key == 9 || (key >= 48 && key <= 57) || (key >= 96 && key <= 105));
    };
    function ValidateEmail(mail) {
        if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) {
            return (true)
        }
        // alert("You have entered an invalid email address!")
        return (false)
    }
    $(document).ready(function () {
        $("#inputEmail").on('keyup blur', function () {
            emailb = ValidateEmail(document.getElementById("inputEmail").value)
            if (emailb) {
                $.ajax({
                    type: 'GET',
                    url: '/emails',
                    data: { emailt: document.getElementById("inputEmail").value },
                    dataType: 'json'                              // <-- add this
                    //contentType: 'application/json; charset=utf-8' // <-- remove this
                })
                    .done(function (result) {
                        if (result.exist) {
                            document.getElementById("emailver").innerHTML = '<span style="color: red;">Email ya registrado</span>'
                            document.getElementById("inputEmail").setCustomValidity('El correo ya est√° resgistrado');
                        } else {
                            document.getElementById("emailver").innerHTML = '<span style="color: green;">Email disponible</span>'
                            document.getElementById("inputEmail").setCustomValidity('');
                        }
                    })
                    .fail(function (xhr, status, error) {
                    })
                    .always(function (data) {
                    });
            } else {
                document.getElementById("emailver").innerHTML = '<span style="color: red;">Email Inv√°lido</span>'
            }
        });
    });
</script>
{{> footer}}